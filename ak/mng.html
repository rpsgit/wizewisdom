---
layout: default
title: ADIMUP ADMIN
---

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#ffd600;   /* Vibrant Yellow */
  --secondary:#ffea00; /* Lighter Yellow */
  --bg:#f4f4f4;
  --text-dark: #111;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Lato', Arial, sans-serif;
  background:var(--bg);
  color: var(--text-dark);
}

/* HEADLINES */
h1, h2, th, button {
  font-family:'Bebas Neue', Arial, sans-serif;
  letter-spacing:.05em;
}

.page{
  max-width:1100px;
  margin:20px auto;
  padding:24px;
  background:#fff;
  border-radius:24px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}

h1{
  text-align:center;
  margin:10px 0 30px;
  font-size: 2.5rem;
}

h2{
  margin-top: 40px;
  border-bottom: 3px solid var(--primary);
  display: inline-block;
  padding-right: 20px;
}

/* BUTTONS */
button{
  border:none;
  padding:10px 20px;
  border-radius:999px;
  background:linear-gradient(135deg,var(--secondary),var(--primary));
  color:var(--text-dark);
  font-size: 1rem;
  cursor:pointer;
  transition: transform 0.1s;
}

button:active { transform: scale(0.96); }

button:disabled {
  background: #eee;
  color: #aaa;
  cursor: not-allowed;
}

button.secondary{
  background: #eee;
  color: #333;
}

/* TABLES */
.table-container {
  overflow-x: auto;
  margin-top: 15px;
}

table{
  width:100%;
  border-collapse:collapse;
  background: #fff;
}

th{
  background: #f8f8f8;
  padding: 12px;
  text-align: left;
  border-bottom: 2px solid #ddd;
  font-size: 1.1rem;
}

td{
  padding: 12px;
  border-bottom: 1px solid #eee;
  font-size: .95rem;
  vertical-align: top;
}

tr:hover { background-color: #fdfdfd; }

.completed-row {
  background-color: #f2fff2 !important;
  color: #777;
}

.center{
  text-align:center;
}

/* NEW ORDER HIGHLIGHT */
.new-order {
  animation: highlight 3s ease-in-out;
}

@keyframes highlight {
  0% { background-color: #fff9c4; }
  50% { background-color: #fff9c4; }
  100% { background-color: transparent; }
}

/* STATUS CHIP */
#storeStatus {
  display: inline-block;
  padding: 5px 15px;
  border-radius: 8px;
  margin-top: 10px;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
}
.status-open { color: #2e7d32; background: #e8f5e9; }
.status-closed { color: #c62828; background: #ffebee; }

/* CHECKBOX STYLING */
input[type="checkbox"] {
  transform: scale(1.5);
  cursor: pointer;
}
</style>

<div class="page">
  <h1>ADIMUP ADMIN PANEL</h1>

  <div class="center">
    <button id="toggleStore">LOADING…</button><br>
    <div id="storeStatus">CHECKING STATUS...</div>
  </div>

  <h2>Recent Orders</h2>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>Name</th>
          <th>Contact</th>
          <th>Address</th>
          <th>Items</th>
          <th>Total</th>
          <th>Notes</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="ordersBody"></tbody>
    </table>
  </div>

  <h2>Menu Management</h2>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Category</th>
          <th>Price</th>
          <th class="center">Sold Out?</th>
        </tr>
      </thead>
      <tbody id="menuTable"></tbody>
    </table>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
// Using the Script ID provided in your script
const BASE = "https://script.google.com/macros/s/AKfycbzq-3_UX7EPlHyZAx0F0I4Khn3z08q12Y2aC99l2ADFCiS_zIOxOGBBObY4suHZyXzD8g/exec";
const MENU_URL = BASE + "?func=getMenu";
const SETTINGS_URL = BASE + "?func=getSettings";

/* ================= SETTINGS ================= */
let storeClosed = false;
const toggleStoreBtn = document.getElementById('toggleStore');
const storeStatusDiv = document.getElementById('storeStatus');

function loadSettings(){
  fetch(SETTINGS_URL)
    .then(r=>r.json())
    .then(s=>{
      storeClosed = !!(s.closed_today || s.auto_closed);
      updateStoreUI();
    });
}

function updateStoreUI(){
  toggleStoreBtn.textContent = storeClosed ? "OPEN STORE NOW" : "CLOSE STORE NOW";
  storeStatusDiv.textContent = storeClosed ? "● STORE IS CURRENTLY CLOSED" : "● STORE IS CURRENTLY OPEN";
  storeStatusDiv.className = storeClosed ? "status-closed" : "status-open";
}

toggleStoreBtn.onclick = ()=>{
  const originalText = toggleStoreBtn.textContent;
  toggleStoreBtn.textContent = "UPDATING...";
  storeClosed = !storeClosed;
  
  fetch(BASE,{
    method:"POST",
    mode: 'no-cors',
    body:new URLSearchParams({
      func:"toggleClose",
      value:storeClosed
    })
  }).then(()=>{
    setTimeout(loadSettings, 1000); // Reload settings to confirm
  });
};

/* ================= ORDERS ================= */
let lastOrderIDs = new Set();
const newOrderSound = new Audio("https://www.soundjay.com/buttons/sounds/button-3.mp3");

function loadOrders(){
  fetch(BASE + "?func=getOrders")
    .then(r=>r.json())
    .then(data=>{
      const ordersBody = document.getElementById('ordersBody');
      ordersBody.innerHTML = "";

      if(!Array.isArray(data) || data.length===0){
        ordersBody.innerHTML = `<tr><td colspan="8" class="center">No orders found in database.</td></tr>`;
        return;
      }

      // Sort Newest first
      data.sort((a,b)=>new Date(b.Time)-new Date(a.Time));

      data.forEach(o=>{
        const tr=document.createElement("tr");
        if(o.Completed) tr.classList.add("completed-row");

        const btn=document.createElement("button");
        btn.textContent = o.Completed ? "✓ DONE" : "MARK DONE";
        btn.disabled = o.Completed;
        btn.onclick = ()=>markCompleted(o.ID, btn, tr);

        tr.innerHTML = `
          <td>${o.Time}</td>
          <td><b>${o.Name}</b></td>
          <td>${o.Contact}</td>
          <td>${o.Address}</td>
          <td>${o.Items.split(',').join('<br>• ')}</td>
          <td><b>₱${o.Total}</b></td>
          <td style="font-style:italic; color:#666">${o.Notes||"-"}</td>
          <td></td>
        `;
        tr.lastElementChild.appendChild(btn);

        // Alert for new orders
        if(lastOrderIDs.size > 0 && !lastOrderIDs.has(o.ID) && !o.Completed){
          tr.classList.add("new-order");
          newOrderSound.play().catch(()=>{});
        }

        lastOrderIDs.add(o.ID);
        ordersBody.appendChild(tr);
      });
    });
}

function markCompleted(id, btn, tr){
  btn.textContent = "...";
  fetch(BASE,{
    method:"POST",
    mode: 'no-cors',
    body:new URLSearchParams({func:"markCompleted", id: id})
  }).then(()=>{
    btn.textContent="✓ DONE";
    btn.disabled=true;
    tr.classList.add("completed-row");
  });
}

/* ================= MENU ================= */
function loadMenu(){
  fetch(MENU_URL)
    .then(r=>r.json())
    .then(data=>{
      const menuTable = document.getElementById('menuTable');
      menuTable.innerHTML="";

      if(!Array.isArray(data)) return;

      data
        .sort((a,b)=>(a.Sort||0)-(b.Sort||0))
        .forEach(item=>{
          const tr=document.createElement("tr");

          const cb=document.createElement("input");
          cb.type="checkbox";
          cb.checked=!!item.SoldOut;
          cb.onchange=()=>toggleSold(item.Item, cb.checked);

          tr.innerHTML=`
            <td><b>${item.Item}</b></td>
            <td>${item.Category||""}</td>
            <td>₱${item.Price}</td>
            <td class="center"></td>
          `;
          tr.lastElementChild.appendChild(cb);
          menuTable.appendChild(tr);
        });
    });
}

function toggleSold(item, value){
  fetch(BASE,{
    method:"POST",
    mode: 'no-cors',
    body:new URLSearchParams({
      func:"toggleSold",
      item: item,
      value: value
    })
  });
}

/* ================= INIT ================= */
loadSettings();
loadOrders();
loadMenu();

// Refresh orders every 30 seconds
setInterval(loadOrders, 30000);
</script>
