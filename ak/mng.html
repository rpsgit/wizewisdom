--- 
layout: default 
title: ADIMUP ADMIN 
--- 

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet"> 

<style> 
:root{ --primary:#ffd600; --secondary:#ffea00; --bg:#f4f4f4; --text-dark: #111; } 
*{box-sizing:border-box} 
body{ margin:0; font-family:'Lato', Arial, sans-serif; background:var(--bg); color: var(--text-dark); } 
h1, h2, th, button, .bebas { font-family:'Bebas Neue', Arial, sans-serif; letter-spacing:.05em; } 
.page{ max-width:1200px; margin:20px auto; padding:24px; background:#fff; border-radius:24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); } 
h1{ text-align:center; margin:10px 0 30px; font-size: 2.5rem; } 
h2{ margin-top: 40px; border-bottom: 3px solid var(--primary); display: inline-block; padding-right: 20px; margin-bottom: 15px; } 

.settings-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
    gap: 15px; 
    background: #f9f9f9; 
    padding: 20px; 
    border-radius: 15px; 
    align-items: end;
}
.settings-grid label { display: block; font-size: 0.8rem; font-weight: 900; margin-bottom: 5px; }
.settings-grid input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Lato'; }

button{ border:none; padding:10px 20px; border-radius:999px; background:linear-gradient(135deg,var(--secondary),var(--primary)); color:var(--text-dark); font-size: 1rem; cursor:pointer; font-weight: bold; } 
button:disabled { background: #eee; color: #aaa; cursor: not-allowed; } 

.table-container { overflow-x: auto; margin-top: 15px; } 
table{ width:100%; border-collapse:collapse; background: #fff; } 
th{ background: #f8f8f8; padding: 12px; text-align: left; border-bottom: 2px solid #ddd; } 
td{ padding: 12px; border-bottom: 1px solid #eee; font-size: .95rem; vertical-align: top; } 

.completed-row { background-color: #f2f2f2 !important; color: #888; opacity: 0.7; } 
.center{ text-align:center; } 
#storeStatus { display: inline-block; padding: 5px 15px; border-radius: 8px; margin-top: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; } 
.status-open { color: #2e7d32; background: #e8f5e9; } 
.status-closed { color: #c62828; background: #ffebee; } 

.pay-tag { background: #111; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
.menu-input { width: 100%; border: 1px solid #ddd; padding: 5px; border-radius: 4px; font-family: 'Lato'; }
.btn-sm { font-size: 0.8rem; padding: 5px 12px; margin: 2px; }
.available-check { width: 22px; height: 22px; cursor: pointer; vertical-align: middle; }
</style> 

<div class="page"> 
  <h1>ADIMUP ADMIN PANEL</h1> 
  
  <div class="center"> 
    <button id="toggleStore" onclick="toggleStoreStatus()">LOADING…</button><br> 
    <div id="storeStatus">CHECKING STATUS...</div> 
  </div> 

  <h2>Global Settings</h2>
  <div class="settings-grid">
      <div>
          <label>GCash Number</label>
          <input type="text" id="gcashNum" placeholder="09xxxxxxxxx">
      </div>
      <div>
          <label>Maya Number</label>
          <input type="text" id="mayaNum" placeholder="09xxxxxxxxx">
      </div>
      <div>
          <button onclick="savePaymentInfo()" style="width: 100%;">Update Info</button>
      </div>
  </div>
  
  <h2>Recent Orders</h2> 
  <div class="table-container"> 
    <table> 
      <thead> 
        <tr> 
          <th>Time / ID</th> 
          <th>Customer</th> 
          <th>Contact / Address</th> 
          <th>Items</th> 
          <th>Total</th> 
          <th>Payment</th> 
          <th>Notes</th> 
          <th>Action</th> 
        </tr> 
      </thead> 
      <tbody id="ordersBody"> 
        <tr><td colspan="8" class="center">Loading orders...</td></tr> 
      </tbody> 
    </table> 
  </div> 
  
  <h2>Menu Management</h2> 
  <div class="table-container"> 
    <table> 
      <thead> 
        <tr> 
          <th style="width: 25%;">Item Name</th> 
          <th style="width: 20%;">Category</th> 
          <th style="width: 15%;">Price</th> 
          <th class="center">Sold Out?</th> 
          <th class="center">Action</th> 
        </tr> 
      </thead> 
      <tbody id="menuBody"></tbody> 
    </table> 
  </div> 
</div> 

<script> 
// Replace this with your exact "Web App URL" from the deployment
const BASE = "https://script.google.com/macros/s/AKfycbwZ6o6IoM9X8R-JKfqZrqE4EAUCkgNRFL5aPlJ9v_CJ80iwZ8QaQ5cdVca480I8qvlsqw/exec"; 

let isStoreClosed = false;
let lastOrderIDs = new Set(); 

async function apiPost(params) {
    try {
        await fetch(BASE, {
            method: "POST",
            mode: "no-cors", // Re-added because Apps Script redirects cause CORS blocks on simple sites
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(params).toString()
        });
        return true;
    } catch (e) {
        console.error("API Error:", e);
        return false;
    }
}

function loadSettings(){ 
  fetch(BASE + "?func=getSettings").then(r=>r.json()).then(s=>{ 
    isStoreClosed = !!(s.closed_today || s.auto_closed); 
    const btn = document.getElementById('toggleStore');
    const status = document.getElementById('storeStatus');
    btn.textContent = isStoreClosed ? "OPEN STORE NOW" : "CLOSE STORE NOW"; 
    status.textContent = isStoreClosed ? "● STORE IS CURRENTLY CLOSED" : "● STORE IS CURRENTLY OPEN"; 
    status.className = isStoreClosed ? "status-closed" : "status-open"; 
    document.getElementById('gcashNum').value = s.gcash_number || '';
    document.getElementById('mayaNum').value = s.maya_number || '';
  }); 
} 

async function savePaymentInfo(){
    const ok = await apiPost({ 
        func: "updatePaymentInfo", 
        gcash_number: document.getElementById('gcashNum').value, 
        maya_number: document.getElementById('mayaNum').value 
    });
    if(ok) alert("Payment information sent! It may take a few seconds to reflect in the sheet.");
}

async function toggleStoreStatus(){
    const btn = document.getElementById('toggleStore');
    btn.disabled = true;
    btn.textContent = "...";
    await apiPost({ func: "toggleClose", status: String(!isStoreClosed) });
    setTimeout(() => { loadSettings(); btn.disabled = false; }, 2000);
}

function loadMenu(){
  fetch(BASE + "?func=getMenu").then(r=>r.json()).then(data=>{
    const mb = document.getElementById('menuBody');
    mb.innerHTML = data.map(m => `
      <tr id="row-${m.row}">
        <td><input type="text" class="menu-input" value="${m.Item}" id="name-${m.row}"></td>
        <td><input type="text" class="menu-input" value="${m.Category}" id="cat-${m.row}"></td>
        <td><input type="number" class="menu-input" value="${m.Price}" id="price-${m.row}"></td>
        <td class="center">
            <input type="checkbox" class="available-check" id="sold-${m.row}" ${String(m.SoldOut) === 'true' ? 'checked' : ''}>
        </td>
        <td class="center">
            <button class="btn-sm" onclick="saveMenuRow(${m.row}, this)">UPDATE</button>
        </td>
      </tr>
    `).join('');
  });
}

async function saveMenuRow(rowId, btn){
    const item = document.getElementById(`name-${rowId}`).value;
    const cat = document.getElementById(`cat-${rowId}`).value;
    const price = document.getElementById(`price-${rowId}`).value;
    const soldOut = document.getElementById(`sold-${rowId}`).checked;

    btn.textContent = "...";
    await apiPost({
        func: "updateMenuItem",
        row: rowId,
        item: item,
        category: cat,
        price: price,
        soldOut: String(soldOut)
    });
    btn.textContent = "SAVED";
    setTimeout(() => { btn.textContent = "UPDATE"; }, 2000);
}

function loadOrders(){ 
  fetch(BASE + "?func=getOrders").then(r=>r.json()).then(data=>{ 
    const ob = document.getElementById('ordersBody'); 
    if(!data.length) { ob.innerHTML = "<tr><td colspan='8' class='center'>No orders found.</td></tr>"; return; }
    ob.innerHTML = "";
    
    [...data].reverse().forEach(o => {
      const tr = document.createElement("tr");
      const currentStatus = o.Status || "Received";
      const isDone = currentStatus === "Delivered";
      
      if(isDone) tr.classList.add("completed-row");
      
      // Define the options for the dropdown
      const statusOptions = ["Received", "Cooking", "Packing", "Delivering", "Delivered"];
      let selectHtml = `<select class="menu-input" onchange="updateStatus('${o.OrderID}', this)" ${isDone ? 'disabled' : ''}>`;
      statusOptions.forEach(opt => {
        selectHtml += `<option value="${opt}" ${currentStatus === opt ? 'selected' : ''}>${opt}</option>`;
      });
      selectHtml += `</select>`;

      tr.innerHTML = `
        <td><small>${o.Timestamp ? new Date(o.Timestamp).toLocaleString() : ''}</small><br><b>${o.OrderID}</b></td>
        <td><b>${o.Name}</b></td>
        <td><small>${o.Contact}</small><br><small style="color:#666">${o.Address}</small></td>
        <td>• ${o.Items ? o.Items.split(',').join('<br>• ') : ''}</td>
        <td><b>₱${o.Total}</b></td>
        <td><span class="pay-tag">${o.Payment}</span></td>
        <td style="font-style:italic; color:#666; font-size:0.85rem">${o.Notes || "-"}</td>
        <td>${selectHtml}</td>
      `;
      ob.appendChild(tr);
    });
  });
}

// New helper function to handle dropdown changes
async function updateStatus(orderID, selectElement){
    const newStatus = selectElement.value;
    selectElement.style.opacity = "0.5";
    await apiPost({func: "markCompleted", id: orderID, status: newStatus});
    setTimeout(loadOrders, 1000); // Refresh to apply styling
}

    
loadSettings(); 
loadMenu(); 
loadOrders(); 
setInterval(loadOrders, 30000); 
</script>
