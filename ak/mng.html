--- 
layout: default 
title: ADIMUP ADMIN 
--- 

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet"> 

<style> 
:root{ --primary:#ffd600; --secondary:#ffea00; --bg:#f4f4f4; --text-dark: #111; } 
*{box-sizing:border-box} 
body{ margin:0; font-family:'Lato', Arial, sans-serif; background:var(--bg); color: var(--text-dark); } 
h1, h2, th, button, .bebas { font-family:'Bebas Neue', Arial, sans-serif; letter-spacing:.05em; } 
.page{ max-width:1200px; margin:20px auto; padding:24px; background:#fff; border-radius:24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); } 
h1{ text-align:center; margin:10px 0 30px; font-size: 2.5rem; } 
h2{ margin-top: 40px; border-bottom: 3px solid var(--primary); display: inline-block; padding-right: 20px; margin-bottom: 15px; } 

.settings-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
    gap: 15px; 
    background: #f9f9f9; 
    padding: 20px; 
    border-radius: 15px; 
    align-items: end;
}
.settings-grid label { display: block; font-size: 0.8rem; font-weight: 900; margin-bottom: 5px; }
.settings-grid input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Lato'; }

button{ border:none; padding:10px 20px; border-radius:999px; background:linear-gradient(135deg,var(--secondary),var(--primary)); color:var(--text-dark); font-size: 1rem; cursor:pointer; font-weight: bold; } 
button:disabled { background: #eee; color: #aaa; cursor: not-allowed; } 

.table-container { overflow-x: auto; margin-top: 15px; } 
table{ width:100%; border-collapse:collapse; background: #fff; } 
th{ background: #f8f8f8; padding: 12px; text-align: left; border-bottom: 2px solid #ddd; } 
td{ padding: 12px; border-bottom: 1px solid #eee; font-size: .95rem; vertical-align: top; } 

.center{ text-align:center; } 
#storeStatus { display: inline-block; padding: 5px 15px; border-radius: 8px; margin-top: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; } 
.status-open { color: #2e7d32; background: #e8f5e9; } 
.status-closed { color: #c62828; background: #ffebee; } 

.menu-input { width: 100%; border: 1px solid #ddd; padding: 5px; border-radius: 4px; font-family: 'Lato'; }
.btn-sm { font-size: 0.75rem; padding: 5px 10px; margin: 2px; }
.btn-del { background: #ff5252; color: white; }
.add-row { background-color: #fff9c4; position: sticky; bottom: 0; }
</style> 

<div class="page"> 
  <h1>ADIMUP ADMIN PANEL</h1> 
  
  <div class="center"> 
    <button id="toggleStore" onclick="toggleStoreStatus()">LOADINGâ€¦</button><br> 
    <div id="storeStatus">CHECKING STATUS...</div> 
  </div> 

  <h2>Global Settings</h2>
  <div class="settings-grid">
      <div>
          <label>GCash Number</label>
          <input type="text" id="gcashNum">
      </div>
      <div>
          <label>Maya Number</label>
          <input type="text" id="mayaNum">
      </div>
      <div>
          <label>Notification Email</label>
          <input type="email" id="adminEmail">
      </div>
      <div>
          <label>Telegram Token</label>
          <input type="password" id="tgToken">
      </div>
      <div>
          <label>Telegram Chat ID</label>
          <input type="text" id="tgChat">
      </div>
      <div>
          <button onclick="saveSettingsInfo()" style="width: 100%;">Update Settings</button>
      </div>
  </div>
  
  <h2>Menu Management</h2> 
  <div class="table-container"> 
    <table> 
      <thead> 
        <tr> 
          <th style="width: 25%;">Item Name</th> 
          <th style="width: 20%;">Category</th> 
          <th style="width: 15%;">Price</th> 
          <th class="center">Sold Out?</th> 
          <th class="center" style="width: 20%;">Action</th> 
        </tr> 
      </thead> 
      <tbody id="menuBody"></tbody>
      <tbody id="addMenuArea">
        <tr class="add-row">
            <td><input type="text" id="newName" class="menu-input" placeholder="New Item Name..."></td>
            <td><input type="text" id="newCat" class="menu-input" placeholder="Category..."></td>
            <td><input type="number" id="newPrice" class="menu-input" placeholder="0.00"></td>
            <td class="center"><input type="checkbox" id="newSold"></td>
            <td class="center">
                <button class="btn-sm" onclick="addNewMenuItem(this)" style="background: #2e7d32; color: white;">+ ADD ITEM</button>
            </td>
        </tr>
      </tbody>
    </table> 
  </div>

  <h2>Recent Orders</h2> 
  <div id="ordersBodyContainer" class="table-container">
      </div>
</div> 

<script> 
const BASE = "https://script.google.com/macros/s/AKfycbzQxxOKG9wIRCptLkzbzJBkbu7XCCb-TrefrXD3Iyg0vVCxATUhHdQU95C2TsloXHBDKg/exec"; 

async function apiPost(params) {
    try {
        await fetch(BASE, {
            method: "POST",
            mode: "no-cors", 
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(params).toString()
        });
        return true;
    } catch (e) { return false; }
}

// LOAD MENU WITH DELETE BUTTON
function loadMenu(){
  fetch(BASE + "?func=getMenu").then(r=>r.json()).then(data=>{
    const mb = document.getElementById('menuBody');
    mb.innerHTML = data.map(m => `
      <tr id="row-${m.row}">
        <td><input type="text" class="menu-input" value="${m.Item}" id="name-${m.row}"></td>
        <td><input type="text" class="menu-input" value="${m.Category}" id="cat-${m.row}"></td>
        <td><input type="number" class="menu-input" value="${m.Price}" id="price-${m.row}"></td>
        <td class="center"><input type="checkbox" id="sold-${m.row}" ${String(m.SoldOut) === 'true' ? 'checked' : ''}></td>
        <td class="center">
            <button class="btn-sm" onclick="saveMenuRow(${m.row}, this)">SAVE</button>
            <button class="btn-sm btn-del" onclick="deleteItem(${m.row}, this)">DEL</button>
        </td>
      </tr>
    `).join('');
  });
}

async function saveMenuRow(rowId, btn){
    btn.textContent = "...";
    await apiPost({
        func: "updateMenuItem",
        row: rowId,
        item: document.getElementById(`name-${rowId}`).value,
        category: document.getElementById(`cat-${rowId}`).value,
        price: document.getElementById(`price-${rowId}`).value,
        soldOut: String(document.getElementById(`sold-${rowId}`).checked)
    });
    btn.textContent = "DONE";
    setTimeout(() => { btn.textContent = "SAVE"; }, 1500);
}

async function deleteItem(rowId, btn) {
    if(!confirm("Are you sure you want to delete this item?")) return;
    btn.textContent = "...";
    const ok = await apiPost({ func: "deleteItem", row: rowId });
    if(ok) {
        btn.closest('tr').style.opacity = "0.3";
        setTimeout(loadMenu, 1000); // Reload to fix row indexing
    }
}

async function addNewMenuItem(btn) {
    const item = document.getElementById('newName').value;
    const cat = document.getElementById('newCat').value;
    const price = document.getElementById('newPrice').value;
    if(!item || !price) return alert("Missing Info");
    btn.disabled = true;
    const ok = await apiPost({
        func: "addNewItem",
        item: item,
        category: cat || "General",
        price: price,
        soldOut: String(document.getElementById('newSold').checked)
    });
    if(ok) {
        document.getElementById('newName').value = "";
        document.getElementById('newPrice').value = "";
        setTimeout(() => { loadMenu(); btn.disabled = false; }, 1500);
    }
}

// ... (Rest of your loadSettings and loadOrders functions remain unchanged) ...
loadSettings(); loadMenu();
</script>
