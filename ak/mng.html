--- 
layout: default 
title: ADIMUP ADMIN 
--- 
  
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet"> 
  
<style> 
:root{ --primary:#ffd600; --secondary:#ffea00; --bg:#f4f4f4; --text-dark: #111; } 
*{box-sizing:border-box} 
body{ margin:0; font-family:'Lato', Arial, sans-serif; background:var(--bg); color: var(--text-dark); } 
h1, h2, th, button, .bebas { font-family:'Bebas Neue', Arial, sans-serif; letter-spacing:.05em; } 
.page{ max-width:1200px; margin:20px auto; padding:24px; background:#fff; border-radius:24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); } 
h1{ text-align:center; margin:10px 0 30px; font-size: 2.5rem; } 
h2{ margin-top: 40px; border-bottom: 3px solid var(--primary); display: inline-block; padding-right: 20px; margin-bottom: 15px; } 

/* Settings Card */
.settings-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
    gap: 15px; 
    background: #f9f9f9; 
    padding: 20px; 
    border-radius: 15px; 
    align-items: end;
}
.settings-grid label { display: block; font-size: 0.8rem; font-weight: 900; margin-bottom: 5px; }
.settings-grid input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Lato'; }

button{ border:none; padding:10px 20px; border-radius:999px; background:linear-gradient(135deg,var(--secondary),var(--primary)); color:var(--text-dark); font-size: 1rem; cursor:pointer; font-weight: bold; } 
button:disabled { background: #eee; color: #aaa; cursor: not-allowed; } 

.table-container { overflow-x: auto; margin-top: 15px; } 
table{ width:100%; border-collapse:collapse; background: #fff; } 
th{ background: #f8f8f8; padding: 12px; text-align: left; border-bottom: 2px solid #ddd; } 
td{ padding: 12px; border-bottom: 1px solid #eee; font-size: .95rem; vertical-align: top; } 

.completed-row { background-color: #f2f2f2 !important; color: #888; opacity: 0.7; } 
.center{ text-align:center; } 
#storeStatus { display: inline-block; padding: 5px 15px; border-radius: 8px; margin-top: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; } 
.status-open { color: #2e7d32; background: #e8f5e9; } 
.status-closed { color: #c62828; background: #ffebee; } 

/* Payment Tag */
.pay-tag { background: #111; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }

/* New Order Animation */ 
.new-order { animation: highlight 3s ease-in-out; } 
@keyframes highlight { 0% { background-color: #fff9c4; } 100% { background-color: transparent; } } 
</style> 
  
<div class="page"> 
  <h1>ADIMUP ADMIN PANEL</h1> 
  
  <div class="center"> 
    <button id="toggleStore" onclick="toggleStoreStatus()">LOADINGâ€¦</button><br> 
    <div id="storeStatus">CHECKING STATUS...</div> 
  </div> 

  <h2>Global Settings</h2>
  <div class="settings-grid">
      <div>
          <label>GCash Number</label>
          <input type="text" id="gcashNum" placeholder="09xxxxxxxxx">
      </div>
      <div>
          <label>Maya Number</label>
          <input type="text" id="mayaNum" placeholder="09xxxxxxxxx">
      </div>
      <div>
          <button onclick="savePaymentInfo()" style="width: 100%;">Update Info</button>
      </div>
  </div>
  
  <h2>Recent Orders</h2> 
  <div class="table-container"> 
    <table> 
      <thead> 
        <tr> 
          <th>Time / ID</th> 
          <th>Customer</th> 
          <th>Contact / Address</th> 
          <th>Items</th> 
          <th>Total</th> 
          <th>Payment</th> 
          <th>Notes</th> 
          <th>Action</th> 
        </tr> 
      </thead> 
      <tbody id="ordersBody"> 
        <tr><td colspan="8" class="center">Loading orders...</td></tr> 
      </tbody> 
    </table> 
  </div> 
  
  <h2>Menu Management</h2> 
  <div class="table-container"> 
    <table> 
      <thead> 
        <tr> 
          <th>Item Name</th> 
          <th>Category</th> 
          <th>Price</th> 
          <th class="center">Availability</th> 
        </tr> 
      </thead> 
      <tbody id="menuBody"></tbody> 
    </table> 
  </div> 
</div> 
  
<script> 
const BASE = "https://script.google.com/macros/s/AKfycbwWOk7xNyjR8jS1UWuzp-BmUNnVEXI-6Db7Cr1iRC0ziqTm01jcSpF-XakD2l5PWcfDNA/exec"; 
  
const toggleStoreBtn = document.getElementById('toggleStore'); 
const storeStatusDiv = document.getElementById('storeStatus'); 
let lastOrderIDs = new Set(); 
let isStoreClosed = false;
const newOrderSound = new Audio("https://www.soundjay.com/buttons/sounds/button-3.mp3"); 
  
function loadSettings(){ 
  fetch(BASE + "?func=getSettings").then(r=>r.json()).then(s=>{ 
    isStoreClosed = !!(s.closed_today || s.auto_closed); 
    toggleStoreBtn.textContent = isStoreClosed ? "OPEN STORE NOW" : "CLOSE STORE NOW"; 
    storeStatusDiv.textContent = isStoreClosed ? "â— STORE IS CURRENTLY CLOSED" : "â— STORE IS CURRENTLY OPEN"; 
    storeStatusDiv.className = isStoreClosed ? "status-closed" : "status-open"; 
    
    document.getElementById('gcashNum').value = s.gcash_number || '';
    document.getElementById('mayaNum').value = s.maya_number || '';
  }); 
} 

async function savePaymentInfo(){
    const g = document.getElementById('gcashNum').value;
    const m = document.getElementById('mayaNum').value;
    const fd = new URLSearchParams({ func: "updatePaymentInfo", gcash_number: g, maya_number: m });
    await fetch(BASE, { method: "POST", mode: "no-cors", body: fd.toString() });
    alert("Payment information updated!");
}

async function toggleStoreStatus(){
    const fd = new URLSearchParams({ func: "toggleClose", status: !isStoreClosed });
    toggleStoreBtn.disabled = true;
    await fetch(BASE, { method: "POST", mode: "no-cors", body: fd.toString() });
    loadSettings();
    toggleStoreBtn.disabled = false;
}
  
function loadOrders(){ 
  fetch(BASE + "?func=getOrders") 
    .then(r=>r.json()) 
    .then(data=>{ 
      const ordersBody = document.getElementById('ordersBody'); 
       
      if(!Array.isArray(data) || data.length === 0){ 
        ordersBody.innerHTML = `<tr><td colspan="8" class="center">No orders found in database.</td></tr>`; 
        return; 
      } 
  
      data.sort((a, b) => { 
        const dateA = a.Time ? new Date(a.Time.replace(/-/g, "/")) : 0; 
        const dateB = b.Time ? new Date(b.Time.replace(/-/g, "/")) : 0; 
        return dateB - dateA; 
      }); 
  
      ordersBody.innerHTML = ""; 
      data.forEach(o=>{ 
        const tr = document.createElement("tr"); 
        if(o.Completed) tr.classList.add("completed-row"); 
  
        const btn = document.createElement("button"); 
        btn.textContent = o.Completed ? "âœ“ DONE" : "MARK DONE"; 
        btn.disabled = o.Completed; 
        btn.onclick = () => markCompleted(o.ID, btn, tr); 
  
        const itemList = o.Items ? o.Items.split(',').join('<br>â€¢ ') : "No items"; 
  
        tr.innerHTML = ` 
          <td><small>${o.Time || 'Unknown'}</small><br><b class="bebas">${o.OrderID || ''}</b></td> 
          <td><b>${o.Name || 'N/A'}</b></td> 
          <td><small>${o.Contact || 'N/A'}</small><br><small style="color:#666">${o.Address || 'N/A'}</small></td> 
          <td>â€¢ ${itemList}</td> 
          <td><b>â‚±${o.Total || '0'}</b></td> 
          <td><span class="pay-tag">${o.Payment || 'Cash'}</span></td> 
          <td style="font-style:italic; color:#666; font-size:0.85rem">${o.Notes || "-"}</td> 
          <td></td> 
        `; 
        tr.lastElementChild.appendChild(btn); 
  
        if(lastOrderIDs.size > 0 && !lastOrderIDs.has(o.ID) && !o.Completed){ 
          tr.classList.add("new-order"); 
          newOrderSound.play().catch(()=>{}); 
        } 
        lastOrderIDs.add(o.ID); 
        ordersBody.appendChild(tr); 
      }); 
    }) 
    .catch(err => { 
      console.error("Order Load Error:", err); 
      document.getElementById('ordersBody').innerHTML = `<tr><td colspan="8" class="center" style="color:red">Error loading orders.</td></tr>`; 
    }); 
} 

function loadMenu(){
  fetch(BASE + "?func=getMenu").then(r=>r.json()).then(data=>{
    const mb = document.getElementById('menuBody');
    mb.innerHTML = data.map(m => `
      <tr>
        <td><b>${m.Item}</b></td>
        <td>${m.Category}</td>
        <td>â‚±${m.Price}</td>
        <td class="center">
            <button class="${m.SoldOut?'':'status-open'}" style="font-size:0.8rem; padding:5px 12px;" onclick="toggleSold('${m.Item}', ${!m.SoldOut})">
                ${m.SoldOut ? 'ðŸ”´ SOLD OUT' : 'ðŸŸ¢ AVAILABLE'}
            </button>
        </td>
      </tr>
    `).join('');
  });
}

function toggleSold(item, status){
    const fd = new URLSearchParams({ func: "toggleSold", item: item, status: status });
    fetch(BASE, { method: "POST", mode: "no-cors", body: fd.toString() }).then(() => {
        setTimeout(loadMenu, 1000);
    });
}
  
function markCompleted(id, btn, tr){ 
  btn.textContent = "..."; 
  fetch(BASE, { 
    method:"POST", 
    mode: 'no-cors', 
    body:new URLSearchParams({func:"markCompleted", id: id}) 
  }).then(()=>{ 
    btn.textContent="âœ“ DONE"; 
    btn.disabled=true; 
    tr.classList.add("completed-row"); 
    setTimeout(loadOrders, 1000); 
  }); 
} 
  
/* ================= INIT ================= */ 
loadSettings(); 
loadOrders(); 
loadMenu(); 
setInterval(loadOrders, 30000); // Auto refresh orders every 30s
</script>
