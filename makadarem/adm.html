---
layout: default
title: MFC ADMIN PANEL
---

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">

<style>
:root {
  --mfc-gold: #c5a059;
  --mfc-dark: #1a1a1a;
  --mfc-bg: #f4f4f4;
  --mfc-white: #ffffff;
  --text-muted: #666;
}

* { box-sizing: border-box; }
body { 
  margin: 0; 
  font-family: 'Montserrat', sans-serif; 
  background: var(--mfc-bg); 
  color: var(--mfc-dark); 
}

h1, h2, h3, th, .mfc-font { 
  font-family: 'Playfair Display', serif; 
}

.page { 
  max-width: 1300px; 
  margin: 20px auto; 
  padding: 40px; 
  background: var(--mfc-white); 
  border-radius: 12px; 
  box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
}

h1 { text-align: center; font-size: 2.5rem; margin-bottom: 40px; border-bottom: 2px solid var(--mfc-gold); padding-bottom: 10px; }
h2 { margin-top: 50px; font-size: 1.8rem; color: var(--mfc-gold); margin-bottom: 20px; }

/* Settings Section */
.settings-grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
  gap: 20px; 
  background: #fafafa; 
  padding: 30px; 
  border-radius: 8px; 
  border: 1px solid #eee;
}
.settings-grid label { display: block; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-bottom: 8px; color: var(--text-muted); }
.settings-grid input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Montserrat'; margin-bottom: 10px; }

/* Buttons */
button { 
  border: none; 
  padding: 15px 25px; 
  border-radius: 4px; 
  background: var(--mfc-dark); 
  color: white; 
  font-family: 'Montserrat'; 
  font-weight: 600; 
  text-transform: uppercase; 
  letter-spacing: 1px; 
  cursor: pointer; 
  transition: 0.3s;
}
button:hover { background: var(--mfc-gold); }
button:disabled { background: #ccc; cursor: not-allowed; }

/* Store Status UI */
.status-banner { text-align: center; margin-bottom: 40px; }
#storeStatus { 
  display: inline-block; 
  padding: 10px 20px; 
  border-radius: 4px; 
  font-weight: 600; 
  margin-top: 15px; 
  font-size: 0.9rem; 
}
.status-open { color: #27ae60; background: #eafaf1; border: 1px solid #27ae60; }
.status-closed { color: #e74c3c; background: #fdedec; border: 1px solid #e74c3c; }

/* Table Styling */
.table-container { overflow-x: auto; margin-top: 20px; }
table { width: 100%; border-collapse: collapse; background: white; border: 1px solid #eee; }
th { background: #f8f8f8; padding: 15px; text-align: left; font-size: 0.85rem; text-transform: uppercase; border-bottom: 2px solid var(--mfc-gold); }
td { padding: 15px; border-bottom: 1px solid #eee; font-size: 0.9rem; vertical-align: top; }

.completed-row { background-color: #f9f9f9 !important; color: #aaa; }
.pay-tag { background: var(--mfc-gold); color: white; padding: 3px 8px; border-radius: 3px; font-size: 0.7rem; font-weight: bold; }
.menu-input { width: 100%; border: 1px solid #ddd; padding: 8px; border-radius: 4px; font-family: 'Montserrat'; }

/* Messenger Floating */
#floatingMessenger {
  position: fixed; bottom: 30px; right: 30px;
  background: #0084FF; color: white; width: 60px; height: 60px;
  border-radius: 50%; display: none; justify-content: center; align-items: center;
  box-shadow: 0 10px 20px rgba(0,0,0,0.2); z-index: 1000;
}
</style>

<div class="page">
  <h1>MFC ADMIN CONTROL</h1>

  <div class="status-banner">
    <button id="toggleStore" onclick="toggleStoreStatus()">SYNCING...</button><br>
    <div id="storeStatus">INITIALIZING...</div>
  </div>

  <h2>Store Settings</h2>
  <div class="settings-grid">
    <div>
      <label>GCash Number</label>
      <input type="text" id="gcashNum" placeholder="09xxxxxxxxx">
      <label>Maya Number</label>
      <input type="text" id="mayaNum" placeholder="09xxxxxxxxx">
    </div>
    <div>
      <label>Notification Email</label>
      <input type="email" id="adminEmail" placeholder="makadarem@gmail.com">
      <label>Messenger Link</label>
      <input type="text" id="messengerLink" placeholder="https://m.me/makadarem">
    </div>
    <div>
      <label>Telegram Token</label>
      <input type="password" id="tgToken">
      <label>Telegram Chat ID</label>
      <input type="text" id="tgChat">
    </div>
    <div style="display:flex; align-items:flex-end;">
      <button onclick="saveSettingsInfo()" style="width:100%; background:var(--mfc-gold);">Update All Settings</button>
    </div>
  </div>

  <h2>Live Orders</h2>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>ID / Date</th>
          <th>Customer</th>
          <th>Order Status</th>
        </tr>
      </thead>
      <tbody id="ordersBody">
        <tr><td colspan="3" style="text-align:center; padding:40px;">Loading live orders...</td></tr>
      </tbody>
    </table>
  </div>

  <h2>Inventory & Menu</h2>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th style="width: 25%;">Item Name</th>
          <th style="width: 20%;">Category</th>
          <th style="width: 15%;">Price (â‚±)</th>
          <th style="text-align:center;">Sold Out?</th>
          <th style="text-align:center;">Action</th>
        </tr>
      </thead>
      <tbody id="menuBody"></tbody>
    </table>
  </div>
</div>

<a id="floatingMessenger" href="#" target="_blank">
  <svg width="30" height="30" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.477 2 2 6.145 2 11.258c0 2.91 1.453 5.527 3.734 7.28l-.01 2.266 2.11-1.154c.734.204 1.516.314 2.32.314 5.523 0 10-4.145 10-9.258S17.523 2 12 2zm1.074 12.553l-2.583-2.753-5.043 2.753 5.543-5.889 2.66 2.753 4.965-2.753-5.542 5.889z"/></svg>
</a>

<script>
// Backend URL from your script
const BASE = "https://script.google.com/macros/s/AKfycbzHFjQDETt7capeSKwMTGsKF99Xp5XN_8WOYXalqR8Zv2u7OJkwWCU5N_i0Z0a58wM8/exec";

let isStoreClosed = false;

async function apiPost(params) {
  try {
    const query = new URLSearchParams(params).toString();
    await fetch(BASE, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: query
    });
    return true;
  } catch (e) { return false; }
}

function loadSettings() {
  fetch(BASE + "?func=getSettings").then(r => r.json()).then(s => {
    // Logic: s.closed_today is Boolean based on your toggleClose function
    isStoreClosed = !!(s.closed_today);
    const btn = document.getElementById('toggleStore');
    const status = document.getElementById('storeStatus');
    
    btn.textContent = isStoreClosed ? "Open Kitchen" : "Close Kitchen";
    status.textContent = isStoreClosed ? "KITCHEN IS CLOSED" : "KITCHEN IS OPEN & ACCEPTING ORDERS";
    status.className = isStoreClosed ? "status-closed" : "status-open";

    document.getElementById('gcashNum').value = s.gcash_number || '';
    document.getElementById('mayaNum').value = s.maya_number || '';
    document.getElementById('adminEmail').value = s.notification_email || '';
    document.getElementById('messengerLink').value = s.messenger_link || '';
    document.getElementById('tgToken').value = s.telegram_token || '';
    document.getElementById('tgChat').value = s.telegram_chat_id || '';

    if (s.messenger_link) {
      document.getElementById('floatingMessenger').href = s.messenger_link;
      document.getElementById('floatingMessenger').style.display = "flex";
    }
  });
}

async function saveSettingsInfo() {
  const ok = await apiPost({
    func: "updatePaymentInfo",
    gcash_number: document.getElementById('gcashNum').value,
    maya_number: document.getElementById('mayaNum').value,
    notification_email: document.getElementById('adminEmail').value,
    messenger_link: document.getElementById('messengerLink').value,
    telegram_token: document.getElementById('tgToken').value,
    telegram_chat_id: document.getElementById('tgChat').value
  });
  if (ok) alert("Backend Settings Synchronized!");
  loadSettings();
}

async function toggleStoreStatus() {
  const btn = document.getElementById('toggleStore');
  btn.disabled = true; btn.textContent = "...";
  // Matches your doPost toggleClose(p)
  await apiPost({ func: "toggleClose", status: String(!isStoreClosed) });
  setTimeout(() => { loadSettings(); btn.disabled = false; }, 1500);
}

function loadMenu() {
  fetch(BASE + "?func=getMenu").then(r => r.json()).then(data => {
    const mb = document.getElementById('menuBody');
    mb.innerHTML = data.map(m => `
      <tr>
        <td><input type="text" class="menu-input" value="${m.Item || ''}" id="name-${m.row}"></td>
        <td><input type="text" class="menu-input" value="${m.Category || ''}" id="cat-${m.row}"></td>
        <td><input type="number" class="menu-input" value="${m.Price || 0}" id="price-${m.row}"></td>
        <td style="text-align:center;"><input type="checkbox" id="sold-${m.row}" ${String(m.SoldOut) === 'true' ? 'checked' : ''}></td>
        <td style="text-align:center;"><button onclick="saveMenuRow(${m.row}, this)" style="padding:5px 10px; font-size:0.6rem;">UPDATE</button></td>
      </tr>
    `).join('');
  });
}

// Note: Your current backend doesn't have updateMenuItem, 
// I've kept the UI here to match the front-end layout you liked.
async function saveMenuRow(rowId, btn) {
  alert("Inventory update logic needs to be added to your Apps Script doPost.");
}

function loadOrders() {
  fetch(BASE + "?func=getOrders").then(r => r.json()).then(data => {
    const ob = document.getElementById('ordersBody');
    if (!data.length) { ob.innerHTML = "<tr><td colspan='3' style='text-align:center;'>No orders yet.</td></tr>"; return; }
    
    ob.innerHTML = "";
    [...data].reverse().forEach(o => {
      const tr = document.createElement("tr");
      const currentStatus = o.Status || "Order Placed";
      const isDelivered = currentStatus === "Delivered";
      if (isDelivered) tr.classList.add("completed-row");

      const stages = ["Order Placed", "Preparing", "Cooking", "Packing", "Out for Delivery", "Delivered"];
      let statusHtml = `<select class="menu-input" onchange="updateOrderStatus('${o.OrderID}', this)" ${isDelivered ? 'disabled' : ''}>`;
      stages.forEach(s => {
        statusHtml += `<option value="${s}" ${currentStatus === s ? 'selected' : ''}>${s}</option>`;
      });
      statusHtml += `</select>`;

      tr.innerHTML = `
        <td><small>${o.Timestamp ? new Date(o.Timestamp).toLocaleDateString() : 'N/A'}</small><br><strong>${o.OrderID}</strong></td>
        <td><strong>${o.Name}</strong></td>
        <td>${statusHtml}</td>
      `;
      ob.appendChild(tr);
    });
  });
}

async function updateOrderStatus(orderID, select) {
  select.style.opacity = "0.5";
  // Matches your doPost markCompleted(p)
  await apiPost({ func: "markCompleted", id: orderID, status: select.value });
  setTimeout(loadOrders, 1000);
}

// Initialize
loadSettings(); loadMenu(); loadOrders();
setInterval(loadOrders, 30000); 
</script>
