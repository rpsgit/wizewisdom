---
layout: default
title: MFC ADMIN PANEL
---

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">

<style>
:root { --mfc-gold: #c5a059; --mfc-dark: #1a1a1a; --mfc-bg: #f4f4f4; --mfc-white: #ffffff; }
body { margin: 0; font-family: 'Montserrat', sans-serif; background: var(--mfc-bg); color: var(--mfc-dark); }
h1, h2, th { font-family: 'Playfair Display', serif; }
.page { max-width: 1300px; margin: 20px auto; padding: 40px; background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
h1 { text-align: center; border-bottom: 2px solid var(--mfc-gold); padding-bottom: 10px; }
.settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; background: #fafafa; padding: 25px; border-radius: 8px; margin-bottom: 30px; }
.settings-grid label { display: block; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; margin-bottom: 5px; color: #666; }
.settings-grid input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; }
button { background: var(--mfc-dark); color: white; border: none; padding: 12px 20px; cursor: pointer; font-weight: 600; text-transform: uppercase; border-radius: 4px; transition: 0.3s; }
button:hover { background: var(--mfc-gold); }
.table-container { overflow-x: auto; margin-top: 20px; }
table { width: 100%; border-collapse: collapse; }
th { text-align: left; padding: 15px; border-bottom: 2px solid var(--mfc-gold); background: #f8f8f8; font-size: 0.85rem; }
td { padding: 15px; border-bottom: 1px solid #eee; font-size: 0.9rem; vertical-align: top; }
.status-open { color: #27ae60; background: #eafaf1; padding: 8px 15px; border-radius: 4px; font-weight: bold; }
.status-closed { color: #e74c3c; background: #fdedec; padding: 8px 15px; border-radius: 4px; font-weight: bold; }
.menu-input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Montserrat'; }
.completed-row { background: #f9f9f9; opacity: 0.7; }
.details-text { font-size: 0.8rem; line-height: 1.4; color: #444; }
.note-tag { color: var(--mfc-gold); font-style: italic; display: block; margin-top: 5px; }

/* New Style for Order Save Button */
.order-header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.btn-save-orders { background: var(--mfc-gold); font-size: 0.8rem; }
</style>

<div class="page">
  <h1>MFC ADMIN CONTROL</h1>

  <div style="text-align: center; margin: 30px 0;">
    <button id="toggleStore" onclick="toggleStoreStatus()">SYNCING...</button>
    <div id="storeStatus" style="margin-top:10px;">LOADING...</div>
  </div>

  <h2>Store Settings</h2>
  <div class="settings-grid">
    <div>
      <label>GCash Number</label><input type="text" id="gcashNum">
      <label>Maya Number</label><input type="text" id="mayaNum">
    </div>
    <div>
      <label>Admin Email</label><input type="email" id="adminEmail">
      <label>Messenger Link</label><input type="text" id="messengerLink">
    </div>
    <div>
      <label>Telegram Token</label><input type="password" id="tgToken">
      <label>Telegram Chat ID</label><input type="text" id="tgChat">
    </div>
    <div style="display:flex; align-items:flex-end;">
      <button onclick="saveSettingsInfo()" style="width:100%; background:var(--mfc-gold);">Update All Settings</button>
    </div>
  </div>

  <div class="order-header-flex">
    <h2>Live Orders</h2>
    <button onclick="saveAllOrderStatuses()" class="btn-save-orders" id="saveOrdersBtn">Save All Status Changes</button>
  </div>
  
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th style="width: 12%;">ID / Date</th>
          <th style="width: 15%;">Customer</th>
          <th style="width: 25%;">Items</th>
          <th style="width: 28%;">Address & Notes</th>
          <th style="width: 20%;">Update Status</th>
        </tr>
      </thead>
      <tbody id="ordersBody"></tbody>
    </table>
  </div>

  <h2>Inventory Management</h2>
  <div class="table-container">
    <table>
      <thead><tr><th>Item</th><th>Category</th><th>Price</th><th style="text-align:center;">Sold Out</th><th>Action</th></tr></thead>
      <tbody id="menuBody"></tbody>
    </table>
  </div>
</div>

<script>
const BASE = "https://script.google.com/macros/s/AKfycbzjKAk8JnwrQx_2QGka3_f0nwTUxdJNzMS4cqkY2DINb9-MVhDUac8UkVI7LLQckjxw/exec";

async function apiPost(params) {
  try {
    await fetch(BASE, {
      method: "POST", mode: "no-cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams(params).toString()
    });
    return true;
  } catch (e) { return false; }
}

function loadSettings() {
  fetch(BASE + "?func=getSettings").then(r => r.json()).then(s => {
    const closed = !!s.closed_today;
    const btn = document.getElementById('toggleStore');
    const status = document.getElementById('storeStatus');
    btn.textContent = closed ? "Open Kitchen" : "Close Kitchen";
    status.textContent = closed ? "KITCHEN IS CLOSED" : "KITCHEN IS OPEN & ACCEPTING ORDERS";
    status.className = closed ? "status-closed" : "status-open";
    
    document.getElementById('gcashNum').value = s.gcash_number || '';
    document.getElementById('mayaNum').value = s.maya_number || '';
    document.getElementById('adminEmail').value = s.notification_email || '';
    document.getElementById('messengerLink').value = s.messenger_link || '';
    document.getElementById('tgToken').value = s.telegram_token || '';
    document.getElementById('tgChat').value = s.telegram_chat_id || '';
  });
}

async function saveSettingsInfo() {
  await apiPost({
    func: "updatePaymentInfo",
    gcash_number: document.getElementById('gcashNum').value,
    maya_number: document.getElementById('mayaNum').value,
    notification_email: document.getElementById('adminEmail').value,
    messenger_link: document.getElementById('messengerLink').value,
    telegram_token: document.getElementById('tgToken').value,
    telegram_chat_id: document.getElementById('tgChat').value
  });
  alert("System Settings Synchronized!");
}

async function toggleStoreStatus() {
  const btn = document.getElementById('toggleStore');
  const currentState = (btn.textContent === "Close Kitchen");
  btn.disabled = true; btn.textContent = "...";
  await apiPost({ func: "toggleClose", status: String(currentState) });
  setTimeout(() => { loadSettings(); btn.disabled = false; }, 1200);
}

function loadMenu() {
  fetch(BASE + "?func=getMenu").then(r => r.json()).then(data => {
    document.getElementById('menuBody').innerHTML = data.map(m => `
      <tr>
        <td><input type="text" class="menu-input" value="${m.Item}" id="name-${m.row}"></td>
        <td><input type="text" class="menu-input" value="${m.Category}" id="cat-${m.row}"></td>
        <td><input type="number" class="menu-input" value="${m.Price}" id="price-${m.row}"></td>
        <td style="text-align:center;"><input type="checkbox" id="sold-${m.row}" ${String(m.SoldOut)==='true'?'checked':''}></td>
        <td><button onclick="saveMenuRow(${m.row}, this)" style="padding:5px 10px; font-size:0.6rem;">UPDATE</button></td>
      </tr>
    `).join('');
  });
}

async function saveMenuRow(rowId, btn) {
  const original = btn.textContent; btn.textContent = "...";
  await apiPost({
    func: "updateMenuItem",
    row: rowId,
    item: document.getElementById(`name-${rowId}`).value,
    category: document.getElementById(`cat-${rowId}`).value,
    price: document.getElementById(`price-${rowId}`).value,
    soldOut: String(document.getElementById(`sold-${rowId}`).checked)
  });
  btn.textContent = "SAVED";
  setTimeout(() => { btn.textContent = original; }, 1000);
}

function loadOrders() {
  fetch(BASE + "?func=getOrders").then(r => r.json()).then(data => {
    const ob = document.getElementById('ordersBody');
    if (!data.length) { ob.innerHTML = "<tr><td colspan='5' style='text-align:center;'>No orders found.</td></tr>"; return; }
    
    const stages = ["Order Placed", "Order Received", "Cooking", "Packing", "Delivering", "Delivered"];
    ob.innerHTML = [...data].reverse().map(o => {
      const isDelivered = o.Status === 'Delivered';
      let options = stages.map(s => `<option value="${s}" ${o.Status === s ? 'selected' : ''}>${s}</option>`).join('');
      
      return `
        <tr class="${isDelivered ? 'completed-row' : ''}">
          <td><small>${o.Timestamp ? new Date(o.Timestamp).toLocaleDateString() : 'N/A'}</small><br><strong>${o.OrderID}</strong></td>
          <td><strong>${o.Name}</strong><br><small>${o.Contact || ''}</small></td>
          <td class="details-text">${o.Items ? o.Items.split(',').join('<br>â€¢ ') : ''}</td>
          <td class="details-text">
            ${o.Address || ''}
            ${o.Notes ? `<span class="note-tag">Note: ${o.Notes}</span>` : ''}
          </td>
          <td>
            <select class="menu-input status-select" data-id="${o.OrderID}" ${isDelivered ? 'disabled' : ''}>
              ${options}
            </select>
          </td>
        </tr>
      `;
    }).join('');
  });
}

// NEW: Function to save all order statuses at once
async function saveAllOrderStatuses() {
  const btn = document.getElementById('saveOrdersBtn');
  const selects = document.querySelectorAll('.status-select:not([disabled])');
  
  if (selects.length === 0) return;

  const originalText = btn.textContent;
  btn.disabled = true;
  btn.textContent = "SAVING CHANGES...";

  // We loop through and send updates. 
  // Note: Since Apps Script handles these via no-cors, we fire them off.
  const promises = Array.from(selects).map(sel => {
    return apiPost({ 
      func: "markCompleted", 
      id: sel.getAttribute('data-id'), 
      status: sel.value 
    });
  });

  await Promise.all(promises);
  
  btn.textContent = "ALL SAVED!";
  setTimeout(() => { 
    btn.disabled = false; 
    btn.textContent = originalText;
    loadOrders(); 
  }, 1500);
}

// Initial Load
loadSettings(); loadMenu(); loadOrders();
// Refresh orders every 30 seconds
setInterval(loadOrders, 30000);
</script>
