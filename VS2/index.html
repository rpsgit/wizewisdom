<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>VS2 Service & Merchandise Directory Search</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    background: #f4f6fb;
    color: #222;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    margin: 0;
  }

  h1 {
    color: #0077cc;
    margin-bottom: 1.2rem;
    text-align: center;
    font-size: 1.8rem;
  }

  .search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
    max-width: 600px;
  }

  input {
    padding: 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
    max-width: 300px;
    outline: none;
    transition: box-shadow 0.2s ease;
  }

  input:focus { box-shadow: 0 0 0 3px rgba(0,119,204,0.2); }

  button {
    padding: 10px 15px;
    background: #0077cc;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  button:hover { background: #005fa3; }

  .summary {
    width: 100%;
    max-width: 800px;
    background: white;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    text-align: left;
  }

  .summary h2 { color: #0077cc; font-size: 1.2rem; margin-bottom: 8px; }

  .summary ul {
    list-style-type: disc;
    padding-left: 1.5rem;
    columns: 2;
    column-gap: 2rem;
  }

  .summary li { margin-bottom: 6px; break-inside: avoid; }

  .summary a { color: #0077cc; text-decoration: none; transition: color 0.2s ease; }
  .summary a:hover { text-decoration: underline; color: #005fa3; }

  .table-container {
    width: 100%;
    max-width: 900px;
    overflow-x: auto;
    border-radius: 8px;
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 450px;
    cursor: pointer;
  }

  th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; white-space: nowrap; }
  th {
    background: #0077cc;
    color: white;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  tr:hover { background: #f2f8ff; }

  .no-results {
    color: #888;
    margin-top: 1rem;
    font-style: italic;
    text-align: center;
  }

  .details-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    padding: 15px 20px;
    width: 100%;
    max-width: 800px;
  }

  .details-card h3 {
    margin: 0 0 10px;
    color: #0077cc;
    font-size: 1.2rem;
  }

  .details-card p { margin: 6px 0; line-height: 1.4; }

  @media (max-width: 700px) {
    h1 { font-size: 1.4rem; }
    input { width: 100%; }
    .summary ul { columns: 1; }
    th, td { padding: 8px; }
  }
</style>
</head>
<body>
<h1>üîç VS2 Service & Merchandise Directory Search</h1>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="Search for a product or service..." />
  <button onclick="searchServices()">Search</button>
</div>

<div class="summary" id="serviceSummary">
  <h2>Available Products or Services</h2>
  <p>Loading services...</p>
</div>

<div id="results"></div>
<div id="selectedDetails"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxv84VIjZAy56aw0eFcLkXSWXDegGHeUcWIayU_4hmlBCeG1b5rfn8oByX0dA6e3_-A/exec";
let searchTimeout;
let allData = [];

document.addEventListener("DOMContentLoaded", () => {
  fetchServiceSummary();

  const searchInput = document.getElementById("searchInput");
  searchInput.addEventListener("input", () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(searchServices, 400);
  });
  searchInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") { e.preventDefault(); searchServices(); }
  });
});

async function fetchServiceSummary() {
  const summaryDiv = document.getElementById("serviceSummary");
  try {
    const response = await fetch(`${SCRIPT_URL}?func=searchServices&query=`);
    const data = await response.json();
    allData = data;

    if (!data.length) {
      summaryDiv.innerHTML = `<h2>Available Products or Services</h2><p>No services found.</p>`;
      return;
    }

    const services = [...new Set(data.map(item => item["Type of Service"]).filter(Boolean))];

    summaryDiv.innerHTML = `
      <h2>Available Services</h2>
      <ul>
        ${services.map(s => `<li><a href="#" onclick="filterByCategory('${s}')">${s}</a></li>`).join("")}
      </ul>
    `;
  } catch (err) {
    console.error(err);
    summaryDiv.innerHTML = `<h2>Available Services</h2><p>Error loading service list.</p>`;
  }
}

async function searchServices(queryOverride = null) {
  const query = queryOverride || document.getElementById("searchInput").value.trim();
  const resultsDiv = document.getElementById("results");
  document.getElementById("selectedDetails").innerHTML = "";

  if (!query) { resultsDiv.innerHTML = ""; return; }

  resultsDiv.innerHTML = "<p>Searching...</p>";

  try {
    const response = await fetch(`${SCRIPT_URL}?func=searchServices&query=${encodeURIComponent(query)}`);
    const data = await response.json();
    renderResults(data);
  } catch (err) {
    console.error(err);
    resultsDiv.innerHTML = `<p class="no-results">Error fetching data.</p>`;
  }
}

function filterByCategory(category) {
  document.getElementById("searchInput").value = category;
  const filtered = allData.filter(item => item["Type of Service"] === category);
  renderResults(filtered);
}

function renderResults(data) {
  const resultsDiv = document.getElementById("results");

  if (!data.length) {
    resultsDiv.innerHTML = `<p class="no-results">No matching services found.</p>`;
    return;
  }

  const tableHTML = `
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Type of Service</th>
            <th>Description</th>
            <th>Contact Number</th>
          </tr>
        </thead>
        <tbody>
          ${data.map((item, index) => `
            <tr onclick="showFullDetails(${index})">
              <td>${item["Type of Service"] || ""}</td>
              <td>${item["Description"] || ""}</td>
              <td>${item["Contact Number"] || ""}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  `;

  resultsDiv.innerHTML = tableHTML;
  window.currentResults = data;
}

function showFullDetails(index) {
  const item = window.currentResults[index];
  const detailsDiv = document.getElementById("selectedDetails");

  detailsDiv.innerHTML = `
    <div class="details-card">
      <h3>${item["Type of Service"] || "No Type"}</h3>
      <p><strong>Description:</strong> ${item["Description"] || "‚Äî"}</p>
      <p><strong>Contact Name:</strong> ${item["Contact Name"] || "‚Äî"}</p>
      <p><strong>Contact Number:</strong> ${item["Contact Number"] || "‚Äî"}</p>
      <p><strong>Availability:</strong> ${item["Availability"] || "‚Äî"}</p>
      <p><strong>Other Details:</strong> ${item["Other Details"] || "‚Äî"}</p>
    </div>
  `;

  detailsDiv.scrollIntoView({ behavior: "smooth" });
}
</script>
</body>
</html>
