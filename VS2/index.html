<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxv84VIjZAy56aw0eFcLkXSWXDegGHeUcWIayU_4hmlBCeG1b5rfn8oByX0dA6e3_-A/exec";
  let searchTimeout;

  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("searchInput");

    // Trigger search when typing (with debounce)
    searchInput.addEventListener("input", () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(searchServices, 400); // delay to avoid too many calls
    });

    // Trigger search on Enter
    searchInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        searchServices();
      }
    });
  });

  async function searchServices() {
    const query = document.getElementById("searchInput").value.trim();
    const resultsDiv = document.getElementById("results");

    if (!query) {
      resultsDiv.innerHTML = "";
      return;
    }

    resultsDiv.innerHTML = "<p>Searching...</p>";

    try {
      const response = await fetch(`${SCRIPT_URL}?func=searchServices&query=${encodeURIComponent(query)}`);
      const data = await response.json();

      if (data.length === 0) {
        resultsDiv.innerHTML = `<p class="no-results">No matching services found.</p>`;
        return;
      }

      // Build results table
      const tableHTML = `
        <table>
          <thead>
            <tr>
              <th>Type of Service</th>
              <th>Description</th>
              <th>Contact Number</th>
              <th>Contact Name</th>
              <th>Schedule of Operation</th>
            </tr>
          </thead>
          <tbody>
            ${data.map(item => `
              <tr>
                <td>${item["Type of Service"] || ""}</td>
                <td>${item["Description"] || ""}</td>
                <td>${item["Contact Number"] || ""}</td>
                <td>${item["Contact Name"] || ""}</td>
                <td>${item["Schedule of Operation"] || ""}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
      resultsDiv.innerHTML = tableHTML;
    } catch (err) {
      console.error(err);
      resultsDiv.innerHTML = `<p class="no-results">Error fetching data. Please try again later.</p>`;
    }
  }
</script>
